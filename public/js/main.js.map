{
  "version": 3,
  "sources": ["../../src/js/main.js"],
  "sourcesContent": ["// L\u1EA5y th\u00F4ng tin user t\u1EEB HTML\nconst userInfo = document.getElementById('user-info');\nconst currentUserId = userInfo.dataset.id;\nconst currentUserName = userInfo.dataset.name;\n\n// Kh\u1EDFi t\u1EA1o Socket.io v\u1EDBi userId \u0111\u1EC3 x\u00E1c th\u1EF1c\nconst socket = io({\n    auth: { userId: currentUserId }\n});\n\n// State qu\u1EA3n l\u00FD chat hi\u1EC7n t\u1EA1i\nlet activeConversationId = null;\n\n// DOM Elements\nconst conversationList = document.getElementById('conversation-list');\nconst messagesList = document.getElementById('messages-list');\nconst chatWindow = document.getElementById('chat-window');\nconst noChatSelected = document.getElementById('no-chat-selected');\nconst activeChatTitle = document.getElementById('active-chat-title');\nconst activeChatAvatar = document.getElementById('active-chat-avatar');\nconst chatForm = document.getElementById('chat-form');\nconst msgInput = document.getElementById('msg-input');\nconst aiSuggestBtn = document.getElementById('ai-suggest-btn');\n\n/**\n * Hi\u1EC3n th\u1ECB tin nh\u1EAFn l\u00EAn m\u00E0n h\u00ECnh\n */\nfunction appendMessage(msg) {\n    const isMe = msg.sender_id === currentUserId;\n    const isSystem = msg.type === 'system';\n    \n    let msgHtml = '';\n    \n    if (isSystem) {\n        msgHtml = `<div class=\"msg-system text-center my-2 small text-muted\"><em><strong>${msg.sender?.display_name || 'H\u1EC7 th\u1ED1ng'}</strong> ${msg.content}</em></div>`;\n    } else {\n        msgHtml = `\n            <div class=\"msg-bubble ${isMe ? 'msg-right' : 'msg-left'}\">\n                ${!isMe ? `<div class=\"msg-info\"><strong>${msg.sender?.display_name || 'Ng\u01B0\u1EDDi d\u00F9ng'}</strong></div>` : ''}\n                <div>${msg.content}</div>\n                <div class=\"msg-info text-end small opacity-75\">${new Date(msg.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>\n            </div>\n        `;\n    }\n    \n    messagesList.insertAdjacentHTML('beforeend', msgHtml);\n    messagesList.scrollTop = messagesList.scrollHeight;\n}\n\n/**\n * Load tin nh\u1EAFn c\u1EE7a m\u1ED9t cu\u1ED9c h\u1ED9i tho\u1EA1i\n */\nasync function loadMessages(conversationId) {\n    try {\n        const response = await fetch(`/api/conversations/${conversationId}/messages`);\n        const messages = await response.json();\n        \n        messagesList.innerHTML = '';\n        messages.forEach(msg => appendMessage(msg));\n        messagesList.scrollTop = messagesList.scrollHeight;\n    } catch (error) {\n        console.error('L\u1ED7i khi load tin nh\u1EAFn:', error);\n    }\n}\n\n/**\n * X\u1EED l\u00FD ch\u1ECDn cu\u1ED9c h\u1ED9i tho\u1EA1i\n */\nif (conversationList) {\n    conversationList.addEventListener('click', (e) => {\n        const item = e.target.closest('.conv-item');\n        if (!item) return;\n\n        // UI Updates\n        document.querySelectorAll('.conv-item').forEach(el => el.classList.remove('active'));\n        item.classList.add('active');\n        \n        activeConversationId = item.dataset.id;\n        const title = item.querySelector('h6').innerText;\n        const avatar = item.querySelector('.user-badge').innerText;\n\n        activeChatTitle.innerText = title;\n        activeChatAvatar.innerText = avatar;\n        \n        noChatSelected.classList.add('d-none');\n        chatWindow.classList.remove('d-none');\n        chatWindow.classList.add('d-flex');\n\n        // Socket: Join room\n        socket.emit('room:join', activeConversationId);\n\n        // Load data\n        loadMessages(activeConversationId);\n    });\n}\n\n/**\n * G\u1EEDi tin nh\u1EAFn\n */\nif (chatForm) {\n    chatForm.addEventListener('submit', (e) => {\n        e.preventDefault();\n        const content = msgInput.value.trim();\n        if (!content || !activeConversationId) return;\n\n        // G\u1EEDi qua socket\n        socket.emit('message:send', {\n            conversationId: activeConversationId,\n            content: content,\n            type: 'text'\n        });\n\n        msgInput.value = '';\n        msgInput.focus();\n    });\n}\n\n/**\n * X\u1EED l\u00FD G\u1EE3i \u00FD AI\n */\nif (aiSuggestBtn) {\n    aiSuggestBtn.addEventListener('click', async () => {\n        if (!activeConversationId) return alert('Vui l\u00F2ng ch\u1ECDn m\u1ED9t cu\u1ED9c h\u1ED9i tho\u1EA1i');\n\n        aiSuggestBtn.disabled = true;\n        aiSuggestBtn.innerHTML = '<i class=\"fas fa-spinner fa-spin\"></i>';\n\n        try {\n            const response = await fetch(`/api/conversations/${activeConversationId}/suggest`);\n            const data = await response.json();\n            \n            if (data.suggestion) {\n                msgInput.value = data.suggestion;\n                msgInput.focus();\n            } else {\n                alert('AI kh\u00F4ng th\u1EC3 \u0111\u01B0a ra g\u1EE3i \u00FD l\u00FAc n\u00E0y.');\n            }\n        } catch (error) {\n            console.error('L\u1ED7i l\u1EA5y g\u1EE3i \u00FD AI:', error);\n            alert('C\u00F3 l\u1ED7i x\u1EA3y ra khi g\u1ECDi AI.');\n        } finally {\n            aiSuggestBtn.disabled = false;\n            aiSuggestBtn.innerHTML = '<i class=\"fas fa-robot\"></i>';\n        }\n    });\n}\n\n/**\n * Socket Listeners\n */\nsocket.on('message:new', (msg) => {\n    if (msg.conversation_id === activeConversationId) {\n        appendMessage(msg);\n    }\n});\n\nsocket.on('user:status', (data) => {\n    console.log('Tr\u1EA1ng th\u00E1i user thay \u0111\u1ED5i:', data);\n    // C\u00F3 th\u1EC3 c\u1EADp nh\u1EADt UI d\u1EA5u ch\u1EA5m xanh \u1EDF \u0111\u00E2y\n});\n\nsocket.on('error', (err) => {\n    alert(err.message);\n});\n\n/**\n * B\u1EAFt \u0111\u1EA7u chat 1-1 t\u1EEB Modal\n */\ndocument.querySelectorAll('.start-chat-btn').forEach(btn => {\n    btn.addEventListener('click', async () => {\n        const targetUserId = btn.dataset.userId;\n        try {\n            const response = await fetch('/api/conversations/private', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ targetUserId })\n            });\n            await response.json();\n            window.location.reload();\n        } catch (error) {\n            console.error('L\u1ED7i khi t\u1EA1o chat m\u1EDBi:', error);\n        }\n    });\n});\n\n/**\n * X\u1EED l\u00FD t\u1EA1o nh\u00F3m\n */\nconst createGroupForm = document.getElementById('create-group-form');\nif (createGroupForm) {\n    createGroupForm.addEventListener('submit', async (e) => {\n        e.preventDefault();\n        const title = document.getElementById('group-title').value;\n        const memberCheckboxes = document.querySelectorAll('.member-checkbox:checked');\n        const memberIds = Array.from(memberCheckboxes).map(cb => cb.value);\n\n        if (memberIds.length === 0) {\n            return alert('Vui l\u00F2ng ch\u1ECDn \u00EDt nh\u1EA5t m\u1ED9t th\u00E0nh vi\u00EAn');\n        }\n\n        try {\n            const response = await fetch('/api/conversations/group', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ title, memberIds })\n            });\n            await response.json();\n            window.location.reload();\n        } catch (error) {\n            console.error('L\u1ED7i khi t\u1EA1o nh\u00F3m:', error);\n        }\n    });\n}\n"],
  "mappings": "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",
  "names": []
}
